<h3>1.2 Mobile combustion</h3>

<p class="hint">
  ✅ UI ไม่ฟิกจำนวนแถว: กด <b>Add row</b> เพื่อเพิ่มรายการ (จำกัดตาม slot ที่ template รองรับ)
</p>

<!-- Groups (on-road + gasohol) -->
<ng-container *ngFor="let key of groups">
  <div class="group-header">
    <h4>{{ labelFor(key) }}</h4>
    <button type="button" class="btn" (click)="addRow(key)" [disabled]="!canAdd(key)">
      + Add row
    </button>
  </div>

  <table class="grid">
    <thead>
      <tr>
        <th style="width: 60px">Slot</th>
        <th>รายการ</th>
        <th style="width: 140px">หลักฐาน</th>
        <th style="width: 90px">หน่วย</th>
        <th style="width: 110px">รวม</th>
        <th *ngFor="let m of months">{{ m }}</th>
        <th style="width: 80px"></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of groupRows(key)">
        <td>{{ slotLabel(r) }}</td>
        <td>
          <input
            class="text"
            [ngModel]="r.itemName"
            (ngModelChange)="updateField(r, 'itemName', $event)"
            placeholder="ชื่อรายการ/ยานพาหนะ"
          />
          <div class="sub">
            <input
              class="text"
              [ngModel]="r.location"
              (ngModelChange)="updateField(r, 'location', $event)"
              placeholder="สถานที่ (optional)"
            />
          </div>
        </td>
        <td>
          <input
            class="text"
            [ngModel]="r.referenceText"
            (ngModelChange)="updateField(r, 'referenceText', $event)"
            placeholder="บิล/ใบกำกับภาษี"
          />
        </td>
        <td class="center">{{ r.unit || 'L' }}</td>
        <td class="right">{{ formatNumber(total(r), false, 2) }}</td>
        <td class="month" *ngFor="let m of months">
          <input
            type="number"
            class="num"
            [ngModel]="getMonthQty(r, m)"
            (ngModelChange)="updateMonthQty(r, m, $event)"
            placeholder="0"
          />
        </td>
        <td class="center">
          <button type="button" class="btn-danger" (click)="removeRow(r)">Remove</button>
        </td>
      </tr>

      <tr *ngIf="groupRows(key).length === 0">
        <td colspan="20" class="empty">ยังไม่มีรายการ — กด Add row เพื่อเพิ่ม</td>
      </tr>
    </tbody>
  </table>

  <hr class="divider" />
</ng-container>

<!-- Forklift row (single slot in template) -->
<h4 style="margin-top: 18px">{{ labelFor('DIESEL_B7_OFFROAD') }}</h4>

<table class="grid">
  <thead>
    <tr>
      <th>รายการ</th>
      <th style="width: 140px">หลักฐาน</th>
      <th style="width: 90px">หน่วย</th>
      <th style="width: 110px">รวม</th>
      <th *ngFor="let m of months">{{ m }}</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <ng-container *ngIf="getForkliftRow() as r">
        <td>
          <input
            class="text"
            [ngModel]="r.itemName"
            (ngModelChange)="updateField(r, 'itemName', $event)"
            placeholder="Forklift / Off-road"
          />
          <div class="sub">
            <input
              class="text"
              [ngModel]="r.location"
              (ngModelChange)="updateField(r, 'location', $event)"
              placeholder="สถานที่ (optional)"
            />
          </div>
        </td>
        <td>
          <input
            class="text"
            [ngModel]="r.referenceText"
            (ngModelChange)="updateField(r, 'referenceText', $event)"
            placeholder="บิล/ใบกำกับภาษี"
          />
        </td>
        <td class="center">{{ r.unit || 'L' }}</td>
        <td class="right">{{ formatNumber(total(r), false, 2) }}</td>
        <td class="month" *ngFor="let m of months">
          <input
            type="number"
            class="num"
            [ngModel]="getMonthQty(r, m)"
            (ngModelChange)="updateMonthQty(r, m, $event)"
            placeholder="0"
          />
        </td>
      </ng-container>
    </tr>
  </tbody>
</table>
