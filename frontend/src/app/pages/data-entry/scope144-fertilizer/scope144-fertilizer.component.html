<h3>1.4.4 ปุ๋ย</h3>

<p class="hint">หมายเหตุ: ขอชนิด/ประเภทปุ๋ย เช่น ปุ๋ยเคมี สูตร 16-16-16, ปุ๋ยคอก</p>

<div class="header-row">
  <button type="button" class="btn" (click)="addRow()">+ เพิ่มรายการ</button>
</div>

<div class="layout">
  <div class="table-wrapper">
    <table class="grid">
      <thead>
        <tr>
          <th>รายการ</th>
          <th style="width: 160px">หลักฐาน</th>
          <th style="width: 80px">หน่วย</th>
          <th style="width: 110px">รวม</th>
          <th *ngFor="let m of months">{{ m }}</th>
          <th style="width: 80px"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td>
            <input
              class="text"
              [ngModel]="r.itemName"
              (ngModelChange)="updateField(r, 'itemName', $event)"
              placeholder="ชนิด/ประเภทปุ๋ย"
            />
          </td>
          <td>
            <input
              class="text"
              [ngModel]="r.referenceText"
              (ngModelChange)="updateField(r, 'referenceText', $event)"
              placeholder="หลักฐาน"
            />
          </td>
          <td>
            <input
              class="text center"
              [ngModel]="r.unit || 'Kg'"
              (ngModelChange)="updateField(r, 'unit', $event)"
            />
          </td>
          <td class="right">{{ formatNumber(total(r), 2) }}</td>
          <td class="month" *ngFor="let m of months">
            <input
              type="number"
              class="num"
              [ngModel]="getMonthQty(r, m)"
              (ngModelChange)="updateMonthQty(r, m, $event)"
              placeholder="0"
            />
          </td>
          <td class="center">
            <button type="button" class="btn-danger" (click)="removeRow(r)">ลบ</button>
          </td>
        </tr>

        <tr *ngIf="rows.length === 0">
          <td colspan="20" class="empty">ยังไม่มีรายการ — กด “เพิ่มรายการ” เพื่อเพิ่มแถว</td>
        </tr>
      </tbody>
    </table>
  </div>

  <aside class="ef-panel">
    <h4>EF</h4>
    <div class="ef-row">
      <span>EF ปุ๋ยเคมี 16-16-16</span>
      <span class="value">0.0025</span>
    </div>
    <div class="ef-result">0.8596</div>
  </aside>
</div>

<app-evidence-block
  evidenceKey="S1::1.4.4"
  [model]="evidenceModel"
  (modelChange)="evidenceModelChange.emit($event)"
></app-evidence-block>
